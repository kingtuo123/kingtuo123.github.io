<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>STM32 RCC 时钟配置 | Notes</title><meta name=keywords content="stm32"><meta name=description content="Note"><meta name=author content="kingtuo123"><link rel=canonical href=https://kingtuo123.com/posts/stm32-rcc-config/><link crossorigin=anonymous href=/assets/css/stylesheet.1b5446f740bb6871915d4adc115699d5a22c24bc7fa8660e3bfbb6e025fb2c4d.css integrity="sha256-G1RG90C7aHGRXUrcEVaZ1aIsJLx/qGYOO/u24CX7LE0=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kingtuo123.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kingtuo123.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kingtuo123.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kingtuo123.com/apple-touch-icon.png><link rel=mask-icon href=https://kingtuo123.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="STM32 RCC 时钟配置"><meta property="og:description" content="Note"><meta property="og:type" content="article"><meta property="og:url" content="https://kingtuo123.com/posts/stm32-rcc-config/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-07-15T00:00:00+00:00"><meta property="article:modified_time" content="2022-07-15T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="STM32 RCC 时钟配置"><meta name=twitter:description content="Note"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kingtuo123.com/posts/"},{"@type":"ListItem","position":2,"name":"STM32 RCC 时钟配置","item":"https://kingtuo123.com/posts/stm32-rcc-config/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"STM32 RCC 时钟配置","name":"STM32 RCC 时钟配置","description":"Note","keywords":["stm32"],"articleBody":" 寄存器 寄存器 说明 RCC_CR 时钟控制寄存器（Clock control register） RCC_CFGR 时钟配置寄存器（Clock configuration register） RCC_CIR 时钟中断寄存器（Clock interrupt register） RCC_APB2RSTR APB2 外设复位寄存器（APB2 peripheral reset register） RCC_APB1RSTR APB1 外设复位寄存器（APB1 peripheral reset register） RCC_AHBENR AHB 外设时钟使能寄存器（AHB peripheral clock enable register） RCC_APB2EBR APB2 外设时钟使能寄存器 （APB2 peripheral clock enable register） RCC_APB1ENR APB1 外设时钟使能寄存器 （APB1 peripheral clock enable register） RCC_BDCR 备份域控制寄存器（Backup domain control register） RCC_CSR 控制状态寄存器（Control/status register） 头文件定义 typedef struct { __IO uint32_t CR; __IO uint32_t CFGR; __IO uint32_t CIR; __IO uint32_t APB2RSTR; __IO uint32_t APB1RSTR; __IO uint32_t AHBENR; __IO uint32_t APB2ENR; __IO uint32_t APB1ENR; __IO uint32_t BDCR; __IO uint32_t CSR; #ifdef STM32F10X_CL __IO uint32_t AHBRSTR; __IO uint32_t CFGR2; #endif /* STM32F10X_CL */ #if defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || defined (STM32F10X_HD_VL) uint32_t RESERVED0; __IO uint32_t CFGR2; #endif /* STM32F10X_LD_VL || STM32F10X_MD_VL || STM32F10X_HD_VL */ } RCC_TypeDef; 例程 寄存器 void SetSysClockTo72(void) { __IO uint32_t StartUpCounter = 0, HSEStatus = 0; RCC_DeInit(); // 使能 HSE RCC-\u003eCR |= ((uint32_t)0x01 \u003c\u003c 16); // 等待 HSE 启动 do{ HSEStatus = RCC-\u003eCR \u0026 ((uint32_t)0x01 \u003c\u003c 17); StartUpCounter++; }while((HSEStatus == 0) \u0026\u0026 (StartUpCounter != HSE_STARTUP_TIMEOUT)); if ((RCC-\u003eCR \u0026 ((uint32_t)0x01 \u003c\u003c 17)) != RESET){ HSEStatus = (uint32_t)0x01; }else{ HSEStatus = (uint32_t)0x00; } if (HSEStatus == (uint32_t)0x01){ /* 使能 FLASH 预存取缓冲区 */ FLASH-\u003eACR |= FLASH_ACR_PRFTBE; /* Flash 2 wait state */ FLASH-\u003eACR \u0026= (uint32_t)((uint32_t)~FLASH_ACR_LATENCY); FLASH-\u003eACR |= (uint32_t)FLASH_ACR_LATENCY_2; // AHB 时钟 HCLK = SYSCLK 不分频 RCC-\u003eCFGR |= (uint32_t)0x00 \u003c\u003c 4; // 高速 APB2 时钟 PCLK2 = HCLK 不分频 RCC-\u003eCFGR |= (uint32_t)0x00 \u003c\u003c 11; // 低速 APB1 时钟 PCLK1 = HCLK/2 二分频 RCC-\u003eCFGR |= (uint32_t)0x04 \u003c\u003c 8; // PLL 输入时钟源 HSE RCC-\u003eCFGR |= (uint32_t)0x01 \u003c\u003c 16; // HSE 不分频 RCC-\u003eCFGR |= (uint32_t)0x00 \u003c\u003c 17; // PLL 9倍频 PLLCLK = 8MHz * 9 = 72 MHz RCC-\u003eCFGR |= (uint32_t)0x07 \u003c\u003c 18; // 使能 PLL RCC-\u003eCR |= (uint32_t)0x01 \u003c\u003c 24; // 等待 PLL 时钟就绪 while((RCC-\u003eCR \u0026 ((uint32_t)0x01 \u003c\u003c 25)) == 0); // 选择 PLL 作为系统时钟源 RCC-\u003eCFGR |= (uint32_t)0x02 \u003c\u003c 0; // 等待 PLL 作为系统时钟源 while ((RCC-\u003eCFGR \u0026 ((uint32_t)0x02 \u003c\u003c 2)) != (uint32_t)0x08); }else{ // HSE 启动失败 } } 标准库 void SetSysClockTo72(void) { /* RCC system reset(for debug purpose) */ RCC_DeInit(); /* Enable HSE */ RCC_HSEConfig(RCC_HSE_ON); /* Wait till HSE is ready */ HSEStartUpStatus = RCC_WaitForHSEStartUp(); if (HSEStartUpStatus == SUCCESS){ /* Enable Prefetch Buffer */ FLASH_PrefetchBufferCmd(FLASH_PrefetchBuffer_Enable); /* Flash 2 wait state */ FLASH_SetLatency(FLASH_Latency_2); /* HCLK = SYSCLK */ RCC_HCLKConfig(RCC_SYSCLK_Div1); /* PCLK2 = HCLK */ RCC_PCLK2Config(RCC_HCLK_Div1); /* PCLK1 = HCLK/2 */ RCC_PCLK1Config(RCC_HCLK_Div2); /* PLLCLK = 8MHz * 9 = 72 MHz */ RCC_PLLConfig(RCC_PLLSource_HSE_Div1, RCC_PLLMul_9); /* Enable PLL */ RCC_PLLCmd(ENABLE); /* Wait till PLL is ready */ while (RCC_GetFlagStatus(RCC_FLAG_PLLRDY) == RESET); /* Select PLL as system clock source */ RCC_SYSCLKConfig(RCC_SYSCLKSource_PLLCLK); /* Wait till PLL is used as system clock source */ while(RCC_GetSYSCLKSource() != 0x08); }else{ /* If HSE fails to start-up, the application will have wrong clock configuration. User can add here some code to deal with this error */ /* Go to infinite loop */ while (1); } } ","wordCount":"476","inLanguage":"en","datePublished":"2022-07-15T00:00:00Z","dateModified":"2022-07-15T00:00:00Z","author":{"@type":"Person","name":"kingtuo123"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kingtuo123.com/posts/stm32-rcc-config/"},"publisher":{"@type":"Organization","name":"Notes","logo":{"@type":"ImageObject","url":"https://kingtuo123.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kingtuo123.com/ accesskey=h title="Notes (Alt + H)">Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kingtuo123.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://kingtuo123.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://kingtuo123.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://kingtuo123.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>STM32 RCC 时钟配置</h1><div class=post-meta><span title='2022-07-15 00:00:00 +0000 UTC'>July 15, 2022</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%af%84%e5%ad%98%e5%99%a8 aria-label=寄存器>寄存器</a></li><li><a href=#%e5%a4%b4%e6%96%87%e4%bb%b6%e5%ae%9a%e4%b9%89 aria-label=头文件定义>头文件定义</a></li><li><a href=#%e4%be%8b%e7%a8%8b aria-label=例程>例程</a><ul><li><a href=#%e5%af%84%e5%ad%98%e5%99%a8-1 aria-label=寄存器>寄存器</a></li><li><a href=#%e6%a0%87%e5%87%86%e5%ba%93 aria-label=标准库>标准库</a></li></ul></li></ul></div></details></div><div class=post-content><div align=center><img src=1.png style=max-height:1000px></img></div><h2 id=寄存器>寄存器<a hidden class=anchor aria-hidden=true href=#寄存器>#</a></h2><table><thead><tr><th style=text-align:left>寄存器</th><th style=text-align:left>说明</th></tr></thead><tbody><tr><td style=text-align:left>RCC_CR</td><td style=text-align:left>时钟控制寄存器（Clock control register）</td></tr><tr><td style=text-align:left>RCC_CFGR</td><td style=text-align:left>时钟配置寄存器（Clock configuration register）</td></tr><tr><td style=text-align:left>RCC_CIR</td><td style=text-align:left>时钟中断寄存器（Clock interrupt register）</td></tr><tr><td style=text-align:left>RCC_APB2RSTR</td><td style=text-align:left>APB2 外设复位寄存器（APB2 peripheral reset register）</td></tr><tr><td style=text-align:left>RCC_APB1RSTR</td><td style=text-align:left>APB1 外设复位寄存器（APB1 peripheral reset register）</td></tr><tr><td style=text-align:left>RCC_AHBENR</td><td style=text-align:left>AHB 外设时钟使能寄存器（AHB peripheral clock enable register）</td></tr><tr><td style=text-align:left>RCC_APB2EBR</td><td style=text-align:left>APB2 外设时钟使能寄存器 （APB2 peripheral clock enable register）</td></tr><tr><td style=text-align:left>RCC_APB1ENR</td><td style=text-align:left>APB1 外设时钟使能寄存器 （APB1 peripheral clock enable register）</td></tr><tr><td style=text-align:left>RCC_BDCR</td><td style=text-align:left>备份域控制寄存器（Backup domain control register）</td></tr><tr><td style=text-align:left>RCC_CSR</td><td style=text-align:left>控制状态寄存器（Control/status register）</td></tr></tbody></table><h2 id=头文件定义>头文件定义<a hidden class=anchor aria-hidden=true href=#头文件定义>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CFGR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CIR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>APB2RSTR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>APB1RSTR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>AHBENR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>APB2ENR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>APB1ENR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>BDCR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CSR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=cp>#ifdef STM32F10X_CL  
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>AHBRSTR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CFGR2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=cm>/* STM32F10X_CL */</span><span class=cp> 
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#if defined (STM32F10X_LD_VL) || defined (STM32F10X_MD_VL) || defined (STM32F10X_HD_VL)   
</span></span></span><span class=line><span class=cl><span class=cp></span>	<span class=kt>uint32_t</span> <span class=n>RESERVED0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>	<span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CFGR2</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=cp>#endif </span><span class=cm>/* STM32F10X_LD_VL || STM32F10X_MD_VL || STM32F10X_HD_VL */</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span><span class=p>}</span> <span class=n>RCC_TypeDef</span><span class=p>;</span>
</span></span></code></pre></div><h2 id=例程>例程<a hidden class=anchor aria-hidden=true href=#例程>#</a></h2><h3 id=寄存器-1>寄存器<a hidden class=anchor aria-hidden=true href=#寄存器-1>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>SetSysClockTo72</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>StartUpCounter</span> <span class=o>=</span> <span class=mi>0</span><span class=p>,</span> <span class=n>HSEStatus</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>   
</span></span><span class=line><span class=cl>    <span class=nf>RCC_DeInit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1>// 使能 HSE
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CR</span> <span class=o>|=</span> <span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>    <span class=c1>// 等待 HSE 启动
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>do</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HSEStatus</span> <span class=o>=</span> <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CR</span> <span class=o>&amp;</span> <span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>17</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>StartUpCounter</span><span class=o>++</span><span class=p>;</span>  
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>while</span><span class=p>((</span><span class=n>HSEStatus</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=n>StartUpCounter</span> <span class=o>!=</span> <span class=n>HSE_STARTUP_TIMEOUT</span><span class=p>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>((</span><span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CR</span> <span class=o>&amp;</span> <span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>17</span><span class=p>))</span> <span class=o>!=</span> <span class=n>RESET</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=n>HSEStatus</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>HSEStatus</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>HSEStatus</span> <span class=o>==</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* 使能 FLASH 预存取缓冲区 */</span>
</span></span><span class=line><span class=cl>        <span class=n>FLASH</span><span class=o>-&gt;</span><span class=n>ACR</span> <span class=o>|=</span> <span class=n>FLASH_ACR_PRFTBE</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/* Flash 2 wait state */</span>
</span></span><span class=line><span class=cl>        <span class=n>FLASH</span><span class=o>-&gt;</span><span class=n>ACR</span> <span class=o>&amp;=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=o>~</span><span class=n>FLASH_ACR_LATENCY</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=n>FLASH</span><span class=o>-&gt;</span><span class=n>ACR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=n>FLASH_ACR_LATENCY_2</span><span class=p>;</span>    
</span></span><span class=line><span class=cl>      
</span></span><span class=line><span class=cl>        <span class=c1>// AHB 时钟 HCLK = SYSCLK 不分频
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 高速 APB2 时钟 PCLK2 = HCLK 不分频
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>11</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 低速 APB1 时钟 PCLK1 = HCLK/2 二分频
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x04</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// PLL 输入时钟源 HSE
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>16</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// HSE 不分频  
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>17</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// PLL 9倍频 PLLCLK = 8MHz * 9 = 72 MHz
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x07</span> <span class=o>&lt;&lt;</span> <span class=mi>18</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// 使能 PLL
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>24</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 等待 PLL 时钟就绪
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>while</span><span class=p>((</span><span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CR</span> <span class=o>&amp;</span> <span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>25</span><span class=p>))</span> <span class=o>==</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 选择 PLL 作为系统时钟源
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x02</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// 等待 PLL 作为系统时钟源
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>while</span> <span class=p>((</span><span class=n>RCC</span><span class=o>-&gt;</span><span class=n>CFGR</span> <span class=o>&amp;</span> <span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x02</span> <span class=o>&lt;&lt;</span> <span class=mi>2</span><span class=p>))</span> <span class=o>!=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x08</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=c1>// HSE 启动失败
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=标准库>标准库<a hidden class=anchor aria-hidden=true href=#标准库>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>SetSysClockTo72</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* RCC system reset(for debug purpose) */</span>
</span></span><span class=line><span class=cl>    <span class=nf>RCC_DeInit</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Enable HSE */</span>
</span></span><span class=line><span class=cl>    <span class=nf>RCC_HSEConfig</span><span class=p>(</span><span class=n>RCC_HSE_ON</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=cm>/* Wait till HSE is ready */</span>
</span></span><span class=line><span class=cl>    <span class=n>HSEStartUpStatus</span> <span class=o>=</span> <span class=nf>RCC_WaitForHSEStartUp</span><span class=p>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>HSEStartUpStatus</span> <span class=o>==</span> <span class=n>SUCCESS</span><span class=p>){</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Enable Prefetch Buffer */</span>
</span></span><span class=line><span class=cl>        <span class=nf>FLASH_PrefetchBufferCmd</span><span class=p>(</span><span class=n>FLASH_PrefetchBuffer_Enable</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Flash 2 wait state */</span>
</span></span><span class=line><span class=cl>        <span class=nf>FLASH_SetLatency</span><span class=p>(</span><span class=n>FLASH_Latency_2</span><span class=p>);</span>
</span></span><span class=line><span class=cl> 
</span></span><span class=line><span class=cl>        <span class=cm>/* HCLK = SYSCLK */</span>
</span></span><span class=line><span class=cl>        <span class=nf>RCC_HCLKConfig</span><span class=p>(</span><span class=n>RCC_SYSCLK_Div1</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>        <span class=cm>/* PCLK2 = HCLK */</span>
</span></span><span class=line><span class=cl>        <span class=nf>RCC_PCLK2Config</span><span class=p>(</span><span class=n>RCC_HCLK_Div1</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>        <span class=cm>/* PCLK1 = HCLK/2 */</span>
</span></span><span class=line><span class=cl>        <span class=nf>RCC_PCLK1Config</span><span class=p>(</span><span class=n>RCC_HCLK_Div2</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=cm>/* PLLCLK = 8MHz * 9 = 72 MHz */</span>
</span></span><span class=line><span class=cl>        <span class=nf>RCC_PLLConfig</span><span class=p>(</span><span class=n>RCC_PLLSource_HSE_Div1</span><span class=p>,</span> <span class=n>RCC_PLLMul_9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=cm>/* Enable PLL */</span> 
</span></span><span class=line><span class=cl>        <span class=nf>RCC_PLLCmd</span><span class=p>(</span><span class=n>ENABLE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/* Wait till PLL is ready */</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=nf>RCC_GetFlagStatus</span><span class=p>(</span><span class=n>RCC_FLAG_PLLRDY</span><span class=p>)</span> <span class=o>==</span> <span class=n>RESET</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/* Select PLL as system clock source */</span>
</span></span><span class=line><span class=cl>        <span class=nf>RCC_SYSCLKConfig</span><span class=p>(</span><span class=n>RCC_SYSCLKSource_PLLCLK</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/* Wait till PLL is used as system clock source */</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span><span class=p>(</span><span class=nf>RCC_GetSYSCLKSource</span><span class=p>()</span> <span class=o>!=</span> <span class=mh>0x08</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span><span class=k>else</span><span class=p>{</span> 
</span></span><span class=line><span class=cl>        <span class=cm>/* If HSE fails to start-up, the application will have wrong clock configuration.
</span></span></span><span class=line><span class=cl><span class=cm>        User can add here some code to deal with this error */</span>    
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=cm>/* Go to infinite loop */</span>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=p>(</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://kingtuo123.com/tags/stm32/>stm32</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://kingtuo123.com/>Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><div class=footer align=center style=margin-top:-30px><a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备19041170号</a></div><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>