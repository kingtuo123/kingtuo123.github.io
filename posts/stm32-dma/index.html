<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>STM32 DMA | King's Blog</title>
<meta name=keywords content="stm32"><meta name=description content="Note"><meta name=author content><link rel=canonical href=https://kingtuo123.com/posts/stm32-dma/><link crossorigin=anonymous href=/assets/css/stylesheet.57df7441adf44d6379e24b293103bec1cb51d3d7fd2b764084b14e6f0852c55d.css integrity="sha256-V990Qa30TWN54kspMQO+wctR09f9K3ZAhLFObwhSxV0=" rel="preload stylesheet" as=style><link rel=icon href=https://kingtuo123.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kingtuo123.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kingtuo123.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kingtuo123.com/apple-touch-icon.png><link rel=mask-icon href=https://kingtuo123.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kingtuo123.com/posts/stm32-dma/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="STM32 DMA"><meta property="og:description" content="Note"><meta property="og:type" content="article"><meta property="og:url" content="https://kingtuo123.com/posts/stm32-dma/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-10T00:00:00+00:00"><meta property="article:modified_time" content="2022-08-10T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="STM32 DMA"><meta name=twitter:description content="Note"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kingtuo123.com/posts/"},{"@type":"ListItem","position":2,"name":"STM32 DMA","item":"https://kingtuo123.com/posts/stm32-dma/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"STM32 DMA","name":"STM32 DMA","description":"Note","keywords":["stm32"],"articleBody":"寄存器 DMA_ISR DMA 中断状态寄存器（ DMA interrupt status register ） TEIFx：通道x的传输错误标志 HTIFx：通道x的半传输标志 TCIFx：通道x的传输完成标志 GIFx： 通道x的全局中断标志 （TE、HT或TC事件） DMA_IFCR DMA中断标志清除寄存器（DMA interrupt flag clear register） CTEIFx：清除通道x的传输错误标志 CHTIFx：清除通道x的半传输标志 CTCIFx：清除通道x的传输完成标志 CGIFx： 清除通道x的全局中断标志 DMA_CCRx DMA通道x配置寄存器（DMA channel x configuration register） MEM2MEM：存储器到存储器模式 (Memory to memory mode) PL[1:0]：通道优先级 (Channel priority level) MSIZE[1:0]：存储器数据宽度 (Memory size) PSIZE[1:0]：外设数据宽度 (Peripheral size) MINC：存储器地址增量模式 (Memory increment mode) PINC：外设地址增量模式 (Peripheral increment mode) CIRC：循环模式 (Circular mode) DIR：数据传输方向 (Data transfer direction) TEIE：允许传输错误中断 (Transfer error interrupt enable) HTIE：允许半传输中断 (Half transfer interrupt enable) TCIE：允许传输完成中断 (Transfer complete interrupt enable) EN：通道开启 (Channel enable) DMA_CNDTRx DMA通道x传输数量寄存器（DMA channel x number of data register） NDT[15:0]：数据传输数量 (Number of data to transfer) 数据传输数量为0至65535。这个寄存器只能在通道不工作(DMA_CCRx的EN=0)时写入。通道开启后该寄存器变为只读，指示剩余的待传输字节数目。寄存器内容在每次DMA传输后递减。\n数据传输结束后，寄存器的内容或者变为0；或者当该通道配置为自动重加载模式时，寄存器的内容将被自动重新加载为之前配置时的数值。\n当寄存器的内容为0时，无论通道是否开启，都不会发生任何数据传输。\nDMA_CPARx DMA通道x外设地址寄存器（DMA channel x peripheral address register） DMA_CMARx DMA通道x存储器地址寄存器（DMA channel x memory address register） DMA_InitTypeDef 结构体 typedef struct { uint32_t DMA_PeripheralBaseAddr; // 外设地址 uint32_t DMA_MemoryBaseAddr; // 存储器地址 uint32_t DMA_DIR; // 传输方向 uint32_t DMA_BufferSize; // 传输数目 uint32_t DMA_PeripheralInc; // 外设地址增量模式 uint32_t DMA_MemoryInc; // 存储器地址增量模式 uint32_t DMA_PeripheralDataSize; // 外设数据宽度 uint32_t DMA_MemoryDataSize; // 存储器数据宽度 uint32_t DMA_Mode; // 模式选择 uint32_t DMA_Priority; // 通道优先级 uint32_t DMA_M2M; // 存储器到存储器模式 }DMA_InitTypeDef; typedef struct { __IO uint32_t CCR; __IO uint32_t CNDTR; __IO uint32_t CPAR; __IO uint32_t CMAR; } DMA_Channel_TypeDef; 例程 外设到存储器 uint8_t ReceiveBuff[100]; void USART1_DMA_Config(void){ RCC-\u003eAPB2ENR |= (uint32_t)0x05; // 使能GPIOA/AFIO时钟 GPIOA-\u003eCRH |= (uint32_t)0x0B \u003c\u003c 4; // 配置PA9复用推挽输出，最高50MHZ GPIOA-\u003eCRH |= (uint32_t)0x04 \u003c\u003c 8; // 配置PA10浮空输入 RCC-\u003eAPB2ENR |= (uint32_t)0x01 \u003c\u003c 14; // 使能USART1时钟 USART1-\u003eCR1 |= (uint16_t)0x00 \u003c\u003c 12; // 一个起始位，8个数据位 USART1-\u003eCR2 |= (uint16_t)0x00 \u003c\u003c 12; // 一个停止位 USART1-\u003eCR3 |= (uint16_t)0x00 \u003c\u003c 8; // 禁用CTS，RTS硬件流控制 USART1-\u003eCR3 |= (uint16_t)0x0040; // 使能USART1 DMA接收 USART1-\u003eBRR = (uint16_t)0x1D4C; // 波特率9600 USART1-\u003eCR1 |= (uint16_t)0x0B; // 收/发使能 NVIC-\u003eISER[1] |= (uint32_t)0x01 \u003c\u003c (37-32); // 使能USART1中断，中断号是37 NVIC-\u003eIP[9] |= (uint32_t)0x40; // 配置优先级主1子1 USART1-\u003eCR1 |= (uint16_t)0x01 \u003c\u003c 0; // 使能USART1 RCC-\u003eAPB2ENR |= (uint32_t)0x01 \u003c\u003c 0; // 使能DMA1时钟 DMA1_Channel5-\u003eCPAR = USART1_BASE + 0x04; // 外设地址 DMA1_Channel5-\u003eCMAR = (uint32_t)ReceiveBuff;// 存储器地址 DMA1_Channel5-\u003eCCNDTR |= (uint16_t)0x1388; // 数据传输数量 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 14; // 禁止存储器到存储器 DMA1_Channel5-\u003eCCR |= (uint32_t)0x01 \u003c\u003c 12; // 优先级：中 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 10; // 存储器数据宽度8位 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 8; // 外设数据宽度8位 DMA1_Channel5-\u003eCCR |= (uint32_t)0x01 \u003c\u003c 7; // 存储器地址自增 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 6; // 外设地址不自增 DMA1_Channel5-\u003eCCR |= (uint32_t)0x01 \u003c\u003c 5; // 循环模式 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 4; // 从外设读 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 3; // 禁止传输错误中断 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 2; // 禁止半传输中断 DMA1_Channel5-\u003eCCR |= (uint32_t)0x00 \u003c\u003c 1; // 禁止传输完成中断 DMA1_Channel5-\u003eCCR |= (uint32_t)0x01 \u003c\u003c 0; // 开启该DMA通道 //NVIC-\u003eISER[0] |= (uint32_t)0x01 \u003c\u003c 15; // 使能DMA1_Channel5中断，中断号是15 //NVIC-\u003eIP[3] |= (uint32_t)0x40 \u003c\u003c 23; // 配置优先级主1子1 } void USART1_IRQHandler(void){ uint8_t ucTemp; if(USART1-\u003eSR \u0026 (uint16_t)0x10){ // IDLE总线空闲标志 DMA1_Channel5-\u003eCCR \u0026= ~((uint32_t)0x01 \u003c\u003c 0); // 关闭该DMA通道 ucTemp = (uint8_t)(USARTx-\u003eDR \u0026 (uint16_t)0x01FF); // 读取一次数据,清除IDLE DMA1_Channel5-\u003eCCR |= (uint32_t)0x01 \u003c\u003c 0; // 开启该DMA通道 } } void DMA1_Channel5_IRQHandler(void){ } ","wordCount":"423","inLanguage":"en","datePublished":"2022-08-10T00:00:00Z","dateModified":"2022-08-10T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://kingtuo123.com/posts/stm32-dma/"},"publisher":{"@type":"Organization","name":"King's Blog","logo":{"@type":"ImageObject","url":"https://kingtuo123.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kingtuo123.com/ accesskey=h title="Notes (Alt + H)">Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://kingtuo123.com/archives title=Archive>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox=".5 1 15 15" fill="none" stroke="currentcolor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"><rect height="3.5" width="12.5" y="2.75" x="1.75"/><path d="m6.75 9.25h2.5m-6.5-2.5v7.5h10.5v-7.5"/></svg></span></a></li><li><a href=https://kingtuo123.com/categories/ title=Categories>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox=".5 .5 23 23" fill="none" stroke="currentcolor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></span></a></li><li><a href=https://kingtuo123.com/tags/ title=Tags>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="1 0 15 15" fill="none" stroke="currentcolor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round" transform="matrix(-1,0,0,1,0,0)"><polygon points="7.25 14.25,1.75 8.75,8.75 1.75,14.25 1.75,14.25 7.25"/><circle cx="11" cy="5" r=".5" fill="#000"/></svg></span></a></li><li><a href=https://kingtuo123.com/search/ title="Search (Alt + /)" accesskey=/>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"><path d="M21 21l-4.4857-4.4935M19 10.5c0 4.6944-3.8056 8.5-8.5 8.5C5.80558 19 2 15.1944 2 10.5 2 5.80558 5.80558 2 10.5 2 15.1944 2 19 5.80558 19 10.5z"/></svg></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">STM32 DMA</h1><div class=post-meta><span title='2022-08-10 00:00:00 +0000 UTC'>August 10, 2022</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%af%84%e5%ad%98%e5%99%a8 aria-label=寄存器>寄存器</a><ul><li><a href=#dma_isr aria-label=DMA_ISR>DMA_ISR</a></li><li><a href=#dma_ifcr aria-label=DMA_IFCR>DMA_IFCR</a></li><li><a href=#dma_ccrx aria-label=DMA_CCRx>DMA_CCRx</a></li><li><a href=#dma_cndtrx aria-label=DMA_CNDTRx>DMA_CNDTRx</a></li><li><a href=#dma_cparx aria-label=DMA_CPARx>DMA_CPARx</a></li><li><a href=#dma_cmarx aria-label=DMA_CMARx>DMA_CMARx</a></li></ul></li><li><a href=#dma_inittypedef-%e7%bb%93%e6%9e%84%e4%bd%93 aria-label="DMA_InitTypeDef 结构体">DMA_InitTypeDef 结构体</a></li><li><a href=#%e4%be%8b%e7%a8%8b aria-label=例程>例程</a><ul><li><a href=#%e5%a4%96%e8%ae%be%e5%88%b0%e5%ad%98%e5%82%a8%e5%99%a8 aria-label=外设到存储器>外设到存储器</a></li></ul></li></ul></div></details></div><div class=post-content><h2 id=寄存器>寄存器<a hidden class=anchor aria-hidden=true href=#寄存器>#</a></h2><h3 id=dma_isr>DMA_ISR<a hidden class=anchor aria-hidden=true href=#dma_isr>#</a></h3><ul><li>DMA 中断状态寄存器（ DMA interrupt status register ）</li></ul><div align=center><img src=1.png style=max-height:200px></img></div><ul><li>TEIFx：通道x的传输错误标志</li><li>HTIFx：通道x的半传输标志</li><li>TCIFx：通道x的传输完成标志</li><li>GIFx： 通道x的全局中断标志 （TE、HT或TC事件）</li></ul><h3 id=dma_ifcr>DMA_IFCR<a hidden class=anchor aria-hidden=true href=#dma_ifcr>#</a></h3><ul><li>DMA中断标志清除寄存器（DMA interrupt flag clear register）</li></ul><div align=center><img src=2.png style=max-height:250px></img></div><ul><li>CTEIFx：清除通道x的传输错误标志</li><li>CHTIFx：清除通道x的半传输标志</li><li>CTCIFx：清除通道x的传输完成标志</li><li>CGIFx： 清除通道x的全局中断标志</li></ul><h3 id=dma_ccrx>DMA_CCRx<a hidden class=anchor aria-hidden=true href=#dma_ccrx>#</a></h3><ul><li>DMA通道x配置寄存器（DMA channel x configuration register）</li></ul><div align=center><img src=3.png style=max-height:200px></img></div><ul><li>MEM2MEM：存储器到存储器模式 (Memory to memory mode)</li><li>PL[1:0]：通道优先级 (Channel priority level)</li><li>MSIZE[1:0]：存储器数据宽度 (Memory size)</li><li>PSIZE[1:0]：外设数据宽度 (Peripheral size)</li><li>MINC：存储器地址增量模式 (Memory increment mode)</li><li>PINC：外设地址增量模式 (Peripheral increment mode)</li><li>CIRC：循环模式 (Circular mode)</li><li>DIR：数据传输方向 (Data transfer direction)</li><li>TEIE：允许传输错误中断 (Transfer error interrupt enable)</li><li>HTIE：允许半传输中断 (Half transfer interrupt enable)</li><li>TCIE：允许传输完成中断 (Transfer complete interrupt enable)</li><li>EN：通道开启 (Channel enable)</li></ul><h3 id=dma_cndtrx>DMA_CNDTRx<a hidden class=anchor aria-hidden=true href=#dma_cndtrx>#</a></h3><ul><li>DMA通道x传输数量寄存器（DMA channel x number of data register）</li></ul><div align=center><img src=4.png style=max-height:200px></img></div><ul><li>NDT[15:0]：数据传输数量 (Number of data to transfer)</li></ul><p>数据传输数量为0至65535。这个寄存器只能在通道不工作(DMA_CCRx的EN=0)时写入。通道开启后该寄存器变为只读，指示剩余的待传输字节数目。寄存器内容在每次DMA传输后递减。</p><p>数据传输结束后，寄存器的内容或者变为0；或者当该通道配置为自动重加载模式时，寄存器的内容将被自动重新加载为之前配置时的数值。</p><p>当寄存器的内容为0时，无论通道是否开启，都不会发生任何数据传输。</p><h3 id=dma_cparx>DMA_CPARx<a hidden class=anchor aria-hidden=true href=#dma_cparx>#</a></h3><ul><li>DMA通道x外设地址寄存器（DMA channel x peripheral address register）</li></ul><h3 id=dma_cmarx>DMA_CMARx<a hidden class=anchor aria-hidden=true href=#dma_cmarx>#</a></h3><ul><li>DMA通道x存储器地址寄存器（DMA channel x memory address register）</li></ul><h2 id=dma_inittypedef-结构体>DMA_InitTypeDef 结构体<a hidden class=anchor aria-hidden=true href=#dma_inittypedef-结构体>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint32_t</span> <span class=n>DMA_PeripheralBaseAddr</span><span class=p>;</span> <span class=c1>// 外设地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_MemoryBaseAddr</span><span class=p>;</span>     <span class=c1>// 存储器地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_DIR</span><span class=p>;</span>                <span class=c1>// 传输方向
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_BufferSize</span><span class=p>;</span>         <span class=c1>// 传输数目
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_PeripheralInc</span><span class=p>;</span>      <span class=c1>// 外设地址增量模式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_MemoryInc</span><span class=p>;</span>          <span class=c1>// 存储器地址增量模式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_PeripheralDataSize</span><span class=p>;</span> <span class=c1>// 外设数据宽度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_MemoryDataSize</span><span class=p>;</span>     <span class=c1>// 存储器数据宽度
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_Mode</span><span class=p>;</span>               <span class=c1>// 模式选择
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_Priority</span><span class=p>;</span>           <span class=c1>// 通道优先级
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>uint32_t</span> <span class=n>DMA_M2M</span><span class=p>;</span>                <span class=c1>// 存储器到存储器模式
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>}</span><span class=n>DMA_InitTypeDef</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>typedef</span> <span class=k>struct</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CCR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CNDTR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CPAR</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=n>__IO</span> <span class=kt>uint32_t</span> <span class=n>CMAR</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=n>DMA_Channel_TypeDef</span><span class=p>;</span>
</span></span></code></pre></div><h2 id=例程>例程<a hidden class=anchor aria-hidden=true href=#例程>#</a></h2><h3 id=外设到存储器>外设到存储器<a hidden class=anchor aria-hidden=true href=#外设到存储器>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>uint8_t</span> <span class=n>ReceiveBuff</span><span class=p>[</span><span class=mi>100</span><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>USART1_DMA_Config</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>APB2ENR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x05</span><span class=p>;</span>             <span class=c1>// 使能GPIOA/AFIO时钟
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>GPIOA</span><span class=o>-&gt;</span><span class=n>CRH</span>   <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x0B</span> <span class=o>&lt;&lt;</span> <span class=mi>4</span><span class=p>;</span>        <span class=c1>// 配置PA9复用推挽输出，最高50MHZ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>GPIOA</span><span class=o>-&gt;</span><span class=n>CRH</span>   <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x04</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>;</span>        <span class=c1>// 配置PA10浮空输入
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>APB2ENR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>;</span>       <span class=c1>// 使能USART1时钟
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>CR1</span>  <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>;</span>       <span class=c1>// 一个起始位，8个数据位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>CR2</span>  <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>;</span>       <span class=c1>// 一个停止位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>CR3</span>  <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>8</span><span class=p>;</span>        <span class=c1>// 禁用CTS，RTS硬件流控制
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>CR3</span>   <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x0040</span><span class=p>;</span>          <span class=c1>// 使能USART1 DMA接收
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>BRR</span>   <span class=o>=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x1D4C</span><span class=p>;</span>           <span class=c1>// 波特率9600
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>CR1</span>  <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x0B</span><span class=p>;</span>             <span class=c1>// 收/发使能
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=n>NVIC</span><span class=o>-&gt;</span><span class=n>ISER</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=p>(</span><span class=mi>37</span><span class=o>-</span><span class=mi>32</span><span class=p>);</span> <span class=c1>// 使能USART1中断，中断号是37
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>NVIC</span><span class=o>-&gt;</span><span class=n>IP</span><span class=p>[</span><span class=mi>9</span><span class=p>]</span>   <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x40</span><span class=p>;</span>            <span class=c1>// 配置优先级主1子1
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>USART1</span><span class=o>-&gt;</span><span class=n>CR1</span>   <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>0</span><span class=p>;</span>       <span class=c1>// 使能USART1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>RCC</span><span class=o>-&gt;</span><span class=n>APB2ENR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span>  <span class=mi>0</span><span class=p>;</span>       <span class=c1>// 使能DMA1时钟
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CPAR</span> <span class=o>=</span> <span class=n>USART1_BASE</span> <span class=o>+</span> <span class=mh>0x04</span><span class=p>;</span>   <span class=c1>// 外设地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CMAR</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=n>ReceiveBuff</span><span class=p>;</span><span class=c1>// 存储器地址
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCNDTR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x1388</span><span class=p>;</span>  <span class=c1>// 数据传输数量
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>14</span><span class=p>;</span> <span class=c1>// 禁止存储器到存储器
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span> <span class=mi>12</span><span class=p>;</span> <span class=c1>// 优先级：中
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span> <span class=mi>10</span><span class=p>;</span> <span class=c1>// 存储器数据宽度8位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span>  <span class=mi>8</span><span class=p>;</span> <span class=c1>// 外设数据宽度8位
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span>  <span class=mi>7</span><span class=p>;</span> <span class=c1>// 存储器地址自增
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span>  <span class=mi>6</span><span class=p>;</span> <span class=c1>// 外设地址不自增
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span>  <span class=mi>5</span><span class=p>;</span> <span class=c1>// 循环模式
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span>  <span class=mi>4</span><span class=p>;</span> <span class=c1>// 从外设读
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span>  <span class=mi>3</span><span class=p>;</span> <span class=c1>// 禁止传输错误中断
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span>  <span class=mi>2</span><span class=p>;</span> <span class=c1>// 禁止半传输中断
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x00</span> <span class=o>&lt;&lt;</span>  <span class=mi>1</span><span class=p>;</span> <span class=c1>// 禁止传输完成中断
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span>  <span class=mi>0</span><span class=p>;</span> <span class=c1>// 开启该DMA通道
</span></span></span><span class=line><span class=cl><span class=c1></span>    
</span></span><span class=line><span class=cl>    <span class=c1>//NVIC-&gt;ISER[0] |= (uint32_t)0x01 &lt;&lt; 15; // 使能DMA1_Channel5中断，中断号是15
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//NVIC-&gt;IP[3]   |= (uint32_t)0x40 &lt;&lt; 23;            // 配置优先级主1子1
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>USART1_IRQHandler</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    <span class=kt>uint8_t</span> <span class=n>ucTemp</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span><span class=p>(</span><span class=n>USART1</span><span class=o>-&gt;</span><span class=n>SR</span> <span class=o>&amp;</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x10</span><span class=p>){</span>                       <span class=c1>// IDLE总线空闲标志
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>&amp;=</span> <span class=o>~</span><span class=p>((</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span>  <span class=mi>0</span><span class=p>);</span>     <span class=c1>// 关闭该DMA通道
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>ucTemp</span> <span class=o>=</span> <span class=p>(</span><span class=kt>uint8_t</span><span class=p>)(</span><span class=n>USARTx</span><span class=o>-&gt;</span><span class=n>DR</span> <span class=o>&amp;</span> <span class=p>(</span><span class=kt>uint16_t</span><span class=p>)</span><span class=mh>0x01FF</span><span class=p>);</span> <span class=c1>// 读取一次数据,清除IDLE
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>DMA1_Channel5</span><span class=o>-&gt;</span><span class=n>CCR</span> <span class=o>|=</span> <span class=p>(</span><span class=kt>uint32_t</span><span class=p>)</span><span class=mh>0x01</span> <span class=o>&lt;&lt;</span>  <span class=mi>0</span><span class=p>;</span>        <span class=c1>// 开启该DMA通道
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>DMA1_Channel5_IRQHandler</span><span class=p>(</span><span class=kt>void</span><span class=p>){</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://kingtuo123.com/tags/stm32/>Stm32</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://kingtuo123.com/>King's Blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><div class=extend_footer align=center style="padding:5px 0 0"><a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备19041170号</a></div><div class=extend_footer align=center style="padding:5px 0 10px"><a href="https://beian.mps.gov.cn/#/query/webSearch?code=33032402001943" rel=noreferrer target=_blank>浙公网安备33032402001943</a></div><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>