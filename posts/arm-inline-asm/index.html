<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>ARM 内联汇编 | Notes</title>
<meta name=keywords content><meta name=description content="arm inline assembly"><meta name=author content><link rel=canonical href=https://kingtuo123.com/posts/arm-inline-asm/><link crossorigin=anonymous href=/assets/css/stylesheet.ae0b697dfd4592766b6d28f598baa3174636777089140ceeffda5ec36afc2de6.css integrity="sha256-rgtpff1FknZrbSj1mLqjF0Y2d3CJFAzu/9pew2r8LeY=" rel="preload stylesheet" as=style><link rel=icon href=https://kingtuo123.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kingtuo123.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kingtuo123.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kingtuo123.com/apple-touch-icon.png><link rel=mask-icon href=https://kingtuo123.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="ARM 内联汇编"><meta property="og:description" content="arm inline assembly"><meta property="og:type" content="article"><meta property="og:url" content="https://kingtuo123.com/posts/arm-inline-asm/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-19T00:00:00+00:00"><meta property="article:modified_time" content="2023-08-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="ARM 内联汇编"><meta name=twitter:description content="arm inline assembly"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kingtuo123.com/posts/"},{"@type":"ListItem","position":2,"name":"ARM 内联汇编","item":"https://kingtuo123.com/posts/arm-inline-asm/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"ARM 内联汇编","name":"ARM 内联汇编","description":"arm inline assembly","keywords":[""],"articleBody":" 参考文章： ARM GCC Inline Assembler Cookbook Writing Arm assembly code ARM内联汇编 [ARM]内联汇编 从0学ARM-内联汇编、混合汇编、ATPCS规则 ARM中C语言和汇编语言的混合编程 内联汇编语句 移动端arm cpu优化学习笔记第4弹–内联汇编入门 Linux Kernel 源码学习必备知识之：GCC 内联汇编 \u003c-推荐看这篇 ARM GCC 格式：\nasm qualifiers ( \"asm code \\n\\t\" : output operand list : input operand list : clobber list ); qualifiers - 修饰符 有三种，也可以不加：volatile，inline，goto\nasm code - 汇编代码 使用双引号包含，多条指令用 \\n\\t分隔，只有单条指令可以不加分隔符，如下：\n\"mov lr, %1 \\n\\t\" operand list - 操作数列表 有输入和输出操作数，多个操作数使用逗号分隔，每个操作数都有下面格式：\n[operand name] \"[modifier]constraint\" (C expression) operand name：操作数名称\nmodifier：修改符，只用于输出操作数\n+ 可读可写 = 只写 \u0026 表示该输出操作数不能使用输入部分使用过的寄存器，只能用 +\u0026 或 =\u0026 的方式使用 constraint：限定符，用于定义变量的存放位置\nr 表示使用任何可用的寄存器 m 表示使用变量的内存地址 i 表示使用立即数 C expression：C 表达式\n输出操作数通常是一个变量 输入操作数可以是变量、常量 clobber list 使用双引号包含，多个参数使用逗号分隔：\n\"r1\", \"r2\", ... 汇编代码执行后会破坏一些内存或寄存器资源，通过此项通知编译器，可能造成寄存器或内存数据的破坏，这样 gcc 就知道哪些寄存器或内存需要提前保护起来。\n常用的参数： r1 表示内联汇编代码修改了通用寄存器 r1，不能用大写 R cc 表示内联汇编代码修改了标志寄存器 memory 表示汇编代码修改了内存，输入或输出操作数（修改了操作数所在的内存） 特殊用法，参考 内存屏障：\nasm volatile(\"\" ::: \"memory\"); memory 强制 gcc 编译器假设 RAM 所有内存单元均被汇编指令修改，这样 cpu 中的 registers 和 cache 中已缓存的内存单元中的数据将作废。cpu 将不得不在需要的时候重新读取内存中的数据。这就阻止了 cpu 又将 registers, cache 中的数据用于去优化指令，而避免去访问内存。\n在汇编代码中引用操作数 方法一，%[操作数名称]：\nint res = 0; // result，input_i，input_j 就是操作数名称 __asm (\"ADD %[result], %[input_i], %[input_j]\" : [result] \"=r\" (res) : [input_i] \"r\" (i), [input_j] \"r\" (j) ); 方法二，%操作数序号：\nint res = 0; // 按变量的顺序，%0 对应 res，%1 对应 i，%2 对应 j __asm (\"ADD %0, %1, %2\" : \"=r\" (res) : \"r\" (i), \"r\" (j) ); 示例程序 #include int add(int i, int j) { int res = 0; __asm (\"ADD %[result], %[input_i], %[input_j]\" : [result] \"=r\" (res) : [input_i] \"r\" (i), [input_j] \"r\" (j) ); return res; } int main(void) { int a = 1; int b = 2; int c = 0; c = add(a,b); printf(\"Result of %d + %d = %d\\n\", a, b, c); } Arm Compiler 6 同上面的格式，参考 ARM 官网 Writing inline assembly code\nArm Compiler 5 Keil 支持 Arm Compiler 5 和 6 两个版本的编译器\n参考 ARM 官网 Using inline assembly to improve code efficiency\n格式：\n__asm { ... instruction ... } 示例：\n#include int add_inline(int r5, int r6) { int res = 0; __asm { ADD res, r5, r6 } return res; } int main(void) { int a = 12; int b = 2; int c = 0; c = add_inline(a,b); printf(\"Result of %d + %d = %d\\n\", a, b, c); } ","wordCount":"339","inLanguage":"en","datePublished":"2023-08-19T00:00:00Z","dateModified":"2023-08-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://kingtuo123.com/posts/arm-inline-asm/"},"publisher":{"@type":"Organization","name":"Notes","logo":{"@type":"ImageObject","url":"https://kingtuo123.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kingtuo123.com/ accesskey=h title="Notes (Alt + H)">Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://kingtuo123.com/archives title=Archive>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox=".5 1 15 15" fill="none" stroke="currentcolor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"><rect height="3.5" width="12.5" y="2.75" x="1.75"/><path d="m6.75 9.25h2.5m-6.5-2.5v7.5h10.5v-7.5"/></svg></span></a></li><li><a href=https://kingtuo123.com/categories/ title=Categories>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox=".5 .5 23 23" fill="none" stroke="currentcolor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></span></a></li><li><a href=https://kingtuo123.com/tags/ title=Tags>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="1 0 15 15" fill="none" stroke="currentcolor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round" transform="matrix(-1,0,0,1,0,0)"><polygon points="7.25 14.25,1.75 8.75,8.75 1.75,14.25 1.75,14.25 7.25"/><circle cx="11" cy="5" r=".5" fill="#000"/></svg></span></a></li><li><a href=https://kingtuo123.com/search/ title="Search (Alt + /)" accesskey=/>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"><path d="M21 21l-4.4857-4.4935M19 10.5c0 4.6944-3.8056 8.5-8.5 8.5C5.80558 19 2 15.1944 2 10.5 2 5.80558 5.80558 2 10.5 2 15.1944 2 19 5.80558 19 10.5z"/></svg></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>ARM 内联汇编</h1><div class=post-meta><span title='2023-08-19 00:00:00 +0000 UTC'>August 19, 2023</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#arm-gcc aria-label="ARM GCC">ARM GCC</a><ul><li><a href=#qualifiers---%e4%bf%ae%e9%a5%b0%e7%ac%a6 aria-label="qualifiers - 修饰符">qualifiers - 修饰符</a></li><li><a href=#asm-code---%e6%b1%87%e7%bc%96%e4%bb%a3%e7%a0%81 aria-label="asm code - 汇编代码">asm code - 汇编代码</a></li><li><a href=#operand-list---%e6%93%8d%e4%bd%9c%e6%95%b0%e5%88%97%e8%a1%a8 aria-label="operand list - 操作数列表">operand list - 操作数列表</a></li><li><a href=#clobber-list aria-label="clobber list">clobber list</a></li><li><a href=#%e5%9c%a8%e6%b1%87%e7%bc%96%e4%bb%a3%e7%a0%81%e4%b8%ad%e5%bc%95%e7%94%a8%e6%93%8d%e4%bd%9c%e6%95%b0 aria-label=在汇编代码中引用操作数>在汇编代码中引用操作数</a></li><li><a href=#%e7%a4%ba%e4%be%8b%e7%a8%8b%e5%ba%8f aria-label=示例程序>示例程序</a></li></ul></li><li><a href=#arm-compiler-6 aria-label="Arm Compiler 6">Arm Compiler 6</a></li><li><a href=#arm-compiler-5 aria-label="Arm Compiler 5">Arm Compiler 5</a></li></ul></div></details></div><div class=post-content><ul><li>参考文章：<ul><li><a href=http://www.ethernut.de/en/documents/arm-inline-asm.html>ARM GCC Inline Assembler Cookbook</a></li><li><a href=https://developer.arm.com/documentation/102694/0100/Introduction>Writing Arm assembly code</a></li><li><a href=https://finsenty54.github.io/2020/09/24/ARM%E5%86%85%E8%81%94%E6%B1%87%E7%BC%96/>ARM内联汇编</a></li><li><a href=https://blog.csdn.net/myprogram_player/article/details/121372941>[ARM]内联汇编</a></li><li><a href=https://zhuanlan.zhihu.com/p/338563574>从0学ARM-内联汇编、混合汇编、ATPCS规则</a></li><li><a href=https://blog.csdn.net/andrewgithub/article/details/79164865>ARM中C语言和汇编语言的混合编程</a></li><li><a href="https://www.ibm.com/docs/zh/openxl-c-and-cpp-aix/17.1.0?topic=features-inline-assembly-statements">内联汇编语句</a></li><li><a href=https://zhuanlan.zhihu.com/p/143328317>移动端arm cpu优化学习笔记第4弹&ndash;内联汇编入门</a></li><li><strong><a href=https://zhuanlan.zhihu.com/p/606376595>Linux Kernel 源码学习必备知识之：GCC 内联汇编</a></strong> <strong>&lt;-推荐看这篇</strong></li></ul></li></ul><h2 id=arm-gcc>ARM GCC<a hidden class=anchor aria-hidden=true href=#arm-gcc>#</a></h2><p>格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>asm qualifiers (
</span></span><span class=line><span class=cl>    &#34;asm code    \n\t&#34; 
</span></span><span class=line><span class=cl>    : output operand list 
</span></span><span class=line><span class=cl>    : input operand list 
</span></span><span class=line><span class=cl>    : clobber list
</span></span><span class=line><span class=cl>);
</span></span></code></pre></div><h3 id=qualifiers---修饰符>qualifiers - 修饰符<a hidden class=anchor aria-hidden=true href=#qualifiers---修饰符>#</a></h3><p>有三种，也可以不加：<code>volatile</code>，<code>inline</code>，<code>goto</code></p><h3 id=asm-code---汇编代码>asm code - 汇编代码<a hidden class=anchor aria-hidden=true href=#asm-code---汇编代码>#</a></h3><p>使用双引号包含，多条指令用 <code>\n\t</code>分隔，只有单条指令可以不加分隔符，如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#34;mov lr, %1    \n\t&#34;
</span></span></code></pre></div><h3 id=operand-list---操作数列表>operand list - 操作数列表<a hidden class=anchor aria-hidden=true href=#operand-list---操作数列表>#</a></h3><p>有输入和输出操作数，多个操作数使用逗号分隔，每个操作数都有下面格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=p>[</span><span class=n>operand</span> <span class=n>name</span><span class=p>]</span> <span class=s2>&#34;[modifier]constraint&#34;</span> <span class=p>(</span><span class=n>C</span> <span class=n>expression</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><p>operand name：操作数名称</p></li><li><p>modifier：修改符，只用于输出操作数</p><ul><li><code>+</code> 可读可写</li><li><code>=</code> 只写</li><li><code>&</code> 表示该输出操作数不能使用输入部分使用过的寄存器，只能用 <code>+&</code> 或 <code>=&</code> 的方式使用</li></ul></li><li><p>constraint：限定符，用于定义变量的存放位置</p><ul><li><code>r</code> 表示使用任何可用的寄存器</li><li><code>m</code> 表示使用变量的内存地址</li><li><code>i</code> 表示使用立即数</li></ul></li><li><p>C expression：C 表达式</p><ul><li>输出操作数通常是一个变量</li><li>输入操作数可以是变量、常量</li></ul></li></ul><h3 id=clobber-list>clobber list<a hidden class=anchor aria-hidden=true href=#clobber-list>#</a></h3><p>使用双引号包含，多个参数使用逗号分隔：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>&#34;r1&#34;, &#34;r2&#34;, ...
</span></span></code></pre></div><p>汇编代码执行后会破坏一些内存或寄存器资源，通过此项通知编译器，可能造成寄存器或内存数据的破坏，这样 gcc 就知道哪些寄存器或内存需要提前保护起来。</p><ul><li>常用的参数：<ul><li><code>r1</code> 表示内联汇编代码修改了通用寄存器 <code>r1</code>，不能用大写 <code>R</code></li><li><code>cc</code> 表示内联汇编代码修改了标志寄存器</li><li><code>memory</code> 表示汇编代码修改了内存，输入或输出操作数（修改了操作数所在的内存）</li></ul></li></ul><p>特殊用法，参考 <a href=https://blog.csdn.net/KISSMonX/article/details/9105823>内存屏障</a>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>asm</span> <span class=nf>volatile</span><span class=p>(</span><span class=s>&#34;&#34;</span> <span class=o>:::</span> <span class=s>&#34;memory&#34;</span><span class=p>);</span>
</span></span></code></pre></div><p>memory 强制 gcc 编译器假设 RAM 所有内存单元均被汇编指令修改，这样 cpu 中的 registers 和 cache 中已缓存的内存单元中的数据将作废。cpu 将不得不在需要的时候重新读取内存中的数据。这就阻止了 cpu 又将 registers, cache 中的数据用于去优化指令，而避免去访问内存。</p><h3 id=在汇编代码中引用操作数>在汇编代码中引用操作数<a hidden class=anchor aria-hidden=true href=#在汇编代码中引用操作数>#</a></h3><p>方法一，<code>%[操作数名称]</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// result，input_i，input_j 就是操作数名称
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>__asm</span> <span class=p>(</span><span class=s>&#34;ADD %[result], %[input_i], %[input_j]&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=p>[</span><span class=n>result</span><span class=p>]</span> <span class=s>&#34;=r&#34;</span> <span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=p>[</span><span class=n>input_i</span><span class=p>]</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=p>[</span><span class=n>input_j</span><span class=p>]</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><p>方法二，<code>%操作数序号</code>：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=c1>// 按变量的顺序，%0 对应 res，%1 对应 i，%2 对应 j
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>__asm</span> <span class=p>(</span><span class=s>&#34;ADD %0, %1, %2&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s>&#34;=r&#34;</span> <span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>);</span>
</span></span></code></pre></div><h3 id=示例程序>示例程序<a hidden class=anchor aria-hidden=true href=#示例程序>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>add</span><span class=p>(</span><span class=kt>int</span> <span class=n>i</span><span class=p>,</span> <span class=kt>int</span> <span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kr>__asm</span> <span class=p>(</span><span class=s>&#34;ADD %[result], %[input_i], %[input_j]&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=p>[</span><span class=n>result</span><span class=p>]</span> <span class=s>&#34;=r&#34;</span> <span class=p>(</span><span class=n>res</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=o>:</span> <span class=p>[</span><span class=n>input_i</span><span class=p>]</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>i</span><span class=p>),</span> <span class=p>[</span><span class=n>input_j</span><span class=p>]</span> <span class=s>&#34;r&#34;</span> <span class=p>(</span><span class=n>j</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>c</span> <span class=o>=</span> <span class=nf>add</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Result of %d + %d = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=arm-compiler-6>Arm Compiler 6<a hidden class=anchor aria-hidden=true href=#arm-compiler-6>#</a></h2><p>同上面的格式，参考 ARM 官网 <a href=https://developer.arm.com/documentation/100748/0620/Using-Assembly-and-Intrinsics-in-C-or-C---Code/Writing-inline-assembly-code>Writing inline assembly code</a></p><h2 id=arm-compiler-5>Arm Compiler 5<a hidden class=anchor aria-hidden=true href=#arm-compiler-5>#</a></h2><p>Keil 支持 Arm Compiler 5 和 6 两个版本的编译器</p><p>参考 ARM 官网 <a href=https://developer.arm.com/documentation/102694/0100/Introduction>Using inline assembly to improve code efficiency</a></p><p>格式：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>__asm
</span></span><span class=line><span class=cl>    {
</span></span><span class=line><span class=cl>        ...
</span></span><span class=line><span class=cl>        instruction
</span></span><span class=line><span class=cl>        ...
</span></span><span class=line><span class=cl>    }
</span></span></code></pre></div><p>示例：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=cp>#include</span>  <span class=cpf>&lt;stdio.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>add_inline</span><span class=p>(</span><span class=kt>int</span> <span class=n>r5</span><span class=p>,</span> <span class=kt>int</span> <span class=n>r6</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>res</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kr>__asm</span>
</span></span><span class=line><span class=cl>    <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ADD</span> <span class=n>res</span><span class=p>,</span> <span class=n>r5</span><span class=p>,</span> <span class=n>r6</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>res</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>(</span><span class=kt>void</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>a</span> <span class=o>=</span> <span class=mi>12</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>b</span> <span class=o>=</span> <span class=mi>2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>int</span> <span class=n>c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>c</span> <span class=o>=</span> <span class=nf>add_inline</span><span class=p>(</span><span class=n>a</span><span class=p>,</span><span class=n>b</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nf>printf</span><span class=p>(</span><span class=s>&#34;Result of %d + %d = %d</span><span class=se>\n</span><span class=s>&#34;</span><span class=p>,</span> <span class=n>a</span><span class=p>,</span> <span class=n>b</span><span class=p>,</span> <span class=n>c</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2023 <a href=https://kingtuo123.com/>Notes</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><div class=extend_footer align=center style=margin-top:-32px><a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备19041170号</a></div><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>