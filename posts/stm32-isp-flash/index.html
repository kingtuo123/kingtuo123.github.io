<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>STM32 ISP 一键下载 | king's blog</title><meta name=keywords content="stm32,linux"><meta name=description content="ISP 一键下载原理，windows 和 linux 平台 ISP 下载方法"><meta name=author content="kingtuo123"><link rel=canonical href=https://kingtuo123.com/posts/stm32-isp-flash/><link crossorigin=anonymous href=/assets/css/stylesheet.min.e82934e550945a9814483ec55d1351d90f24fbe2268d200acb90fbf14dbb8c54.css integrity="sha256-6Ck05VCUWpgUSD7FXRNR2Q8k++ImjSAKy5D78U27jFQ=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://kingtuo123.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kingtuo123.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kingtuo123.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kingtuo123.com/apple-touch-icon.png><link rel=mask-icon href=https://kingtuo123.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="STM32 ISP 一键下载"><meta property="og:description" content="ISP 一键下载原理，windows 和 linux 平台 ISP 下载方法"><meta property="og:type" content="article"><meta property="og:url" content="https://kingtuo123.com/posts/stm32-isp-flash/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-11T00:00:00+00:00"><meta property="article:modified_time" content="2022-05-11T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="STM32 ISP 一键下载"><meta name=twitter:description content="ISP 一键下载原理，windows 和 linux 平台 ISP 下载方法"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kingtuo123.com/posts/"},{"@type":"ListItem","position":2,"name":"STM32 ISP 一键下载","item":"https://kingtuo123.com/posts/stm32-isp-flash/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"STM32 ISP 一键下载","name":"STM32 ISP 一键下载","description":"ISP 一键下载原理，windows 和 linux 平台 ISP 下载方法","keywords":["stm32","linux"],"articleBody":"stm32 启动模式    BOOT0 BOOT1 启动方式      0 X 内部flash，用户程序    1 0 系统存储器，BootLoader    0 1 内部SRAM，程序调试     厂家的 BootLoader 已提供了串口下载的功能，所以我们只要进入 BootLoader 即可。\n即在单片机启动时将BOOT0置高电平，BOOT1置低电平。\n一键下载电路 本文以野火霸道V2.0开发板为例\n    要进入bootloader，有以下流程:\n BOOT1 跳线接 GND DTR 置高电平，RTS 置低电平 Q3 被导通，NRST 被拉低，单片机复位 Q5 被导通，BOOT0 被拉高 DTR 置低电平，释放复位 启动进入 BootLoader  这里注意CH340G 芯片，DTR 和 RTS 输出电平是反向的（芯片图DTR上方有一横线）。所以实际是， DTR 低电平复位，RTS 高电平进入BootLoader。\nWindows ISP 下载   如上图所示：DTR 低电平复位，RTS 高电平进入BootLoader。\nLinux ISP 下载 Linux 下使用 stm32flash 下载。下载解压后文件夹内有 stm32flash_linux 。\n该命令有以下参数\nUsage: stm32flash_linux [-bvngfhc] [-[rw] filename] [tty_device|i2c_device] -a bus_address # 总线地址 -b rate # 波特率 -m mode # 串口模式 -r filename # 读取flash到文件（或者使用 - 符号， 表示标准输出） -w filename # 写入文件到flash（或者使用 - 符号， 表示标准输出） -C # 计算flash crc校验码 -u # 禁用flash写保护 -j # 启用flash读保护 -k # 禁用flash读保护 -o # 仅擦除 -e n # 写入flash前仅擦除n页，默认全擦 -v # 写入后校验 -n count # 写入失败重试次数，默认10 -g address # 指定程序开始执行的地址 -S address[:length] # 指定读取/写入的起始地址和长度（可选） -F RX_length[:TX_length] # 指定接收/发送帧的最大长度 -s start_page # 在指定的页面写入 -f # 强制二进制解析 -h # 显示帮助信息 -c # 恢复连接 -R # 退出时复位设备 -i GPIO_string # 设置进入/退出BootLoader时信号输出的顺序 # GPIO_string=[entry_seq][:[exit_seq]] # sequence=[[-]signal]\u0026|,[sequence] GPIO sequence: # 使用‘dtr’，‘rts’，‘brk’表示串口输出信号 # ‘,’表示在在两个信号之间加100ms延时 # ‘\u0026’表示两个信号之间不加延时 # 在信号前加‘-’表示低电平，不加表示高电平  读取芯片信息，执行以下命令（root）：\nstm32flash_linux -b 115200 -i '-dtr\u0026rts,dtr:-dtr\u0026-rts,dtr' /dev/ttyUSB0 参数说明：\n -b 115200 ，指定115200波特率 -dtr\u0026rts,dtr  -dtr\u0026 拉低复位 rts, 拉高 BOOT0，延时100ms dtr 释放复位，进入 BootLoader   -dtr\u0026-rts,dtr  -dtr\u0026 拉低复位 -rts, 拉低 BOOT0，延时100ms dtr 释放复位，flash启动进入用户程序   /dev/ttyUSB0，设备串口  上述命令执行成功输出以下信息：\nInterface serial_posix: 115200 8E1 GPIO sequence start setting port signal dtr to 0... ok setting port signal rts to 1... ok delay 100000 us setting port signal dtr to 1... ok GPIO sequence end Version : 0x22 Option 1 : 0x00 Option 2 : 0x00 Devive ID : 0x0414 (STM32F10XX High-density) - RAM : Up to 64KiB (512b reserved by bootloader) - Flash : Up to 512Kib (size first sector: 2x2048) - Option RAM : 16b - System RAm : 2KiB GPIO sequence start setting port signal dtr to 0... ok setting port signal rts to 0... ok delay 100000 us setting port signal dtr to 1... ok GPIO sequence end 下载程序，执行以下命令\nstm32flash_linux -b 115200 -i '-dtr\u0026rts,dtr:-dtr\u0026-rts,dtr' -v -w test.bin /dev/ttyUSB0 ","wordCount":"319","inLanguage":"en","datePublished":"2022-05-11T00:00:00Z","dateModified":"2022-05-11T00:00:00Z","author":{"@type":"Person","name":"kingtuo123"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://kingtuo123.com/posts/stm32-isp-flash/"},"publisher":{"@type":"Organization","name":"king's blog","logo":{"@type":"ImageObject","url":"https://kingtuo123.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kingtuo123.com/ accesskey=h title="king's blog (Alt + H)">king's blog</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://kingtuo123.com/archives title=Archive><span>Archive</span></a></li><li><a href=https://kingtuo123.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://kingtuo123.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://kingtuo123.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>STM32 ISP 一键下载</h1><div class=post-meta><span title="2022-05-11 00:00:00 +0000 UTC">May 11, 2022</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#stm32-%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f aria-label="stm32 启动模式">stm32 启动模式</a></li><li><a href=#%e4%b8%80%e9%94%ae%e4%b8%8b%e8%bd%bd%e7%94%b5%e8%b7%af aria-label=一键下载电路>一键下载电路</a></li><li><a href=#windows-isp-%e4%b8%8b%e8%bd%bd aria-label="Windows ISP 下载">Windows ISP 下载</a></li><li><a href=#linux-isp-%e4%b8%8b%e8%bd%bd aria-label="Linux ISP 下载">Linux ISP 下载</a></li></ul></div></details></div><div class=post-content><h2 id=stm32-启动模式>stm32 启动模式<a hidden class=anchor aria-hidden=true href=#stm32-启动模式>#</a></h2><table><thead><tr><th>BOOT0</th><th>BOOT1</th><th>启动方式</th><th></th></tr></thead><tbody><tr><td>0</td><td>X</td><td>内部flash，用户程序</td><td></td></tr><tr><td>1</td><td>0</td><td>系统存储器，BootLoader</td><td></td></tr><tr><td>0</td><td>1</td><td>内部SRAM，程序调试</td><td></td></tr></tbody></table><p>厂家的 BootLoader 已提供了串口下载的功能，所以我们只要进入 BootLoader 即可。</p><p>即在单片机启动时将<code>BOOT0</code>置高电平，<code>BOOT1</code>置低电平。</p><h2 id=一键下载电路>一键下载电路<a hidden class=anchor aria-hidden=true href=#一键下载电路>#</a></h2><p>本文以野火霸道V2.0开发板为例</p><div align=center><img src=3.png style=max-height:320px></img></div><div align=center><img src=2.png style=max-height:320px></img></div><p>要进入bootloader，有以下流程:</p><ol><li><strong>BOOT1</strong> 跳线接 <strong>GND</strong></li><li><strong>DTR</strong> 置高电平，<strong>RTS</strong> 置低电平</li><li><strong>Q3</strong> 被导通，<strong>NRST</strong> 被拉低，单片机复位</li><li><strong>Q5</strong> 被导通，<strong>BOOT0</strong> 被拉高</li><li><strong>DTR</strong> 置低电平，释放复位</li><li>启动进入 <strong>BootLoader</strong></li></ol><p><strong>这里注意CH340G 芯片，DTR 和 RTS 输出电平是反向的（芯片图DTR上方有一横线）。所以实际是， DTR 低电平复位，RTS 高电平进入BootLoader。</strong></p><h2 id=windows-isp-下载>Windows ISP 下载<a hidden class=anchor aria-hidden=true href=#windows-isp-下载>#</a></h2><div align=center><img src=1.png style=max-height:500px></img></div><p>如上图所示：DTR 低电平复位，RTS 高电平进入BootLoader。</p><h2 id=linux-isp-下载>Linux ISP 下载<a hidden class=anchor aria-hidden=true href=#linux-isp-下载>#</a></h2><p>Linux 下使用 <a href=https://sourceforge.net/projects/stm32flash/>stm32flash</a> 下载。下载解压后文件夹内有 <code>stm32flash_linux</code> 。</p><p>该命令有以下参数</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>Usage: stm32flash_linux <span class=o>[</span>-bvngfhc<span class=o>]</span> <span class=o>[</span>-<span class=o>[</span>rw<span class=o>]</span> filename<span class=o>]</span> <span class=o>[</span>tty_device<span class=p>|</span>i2c_device<span class=o>]</span>
</span></span><span class=line><span class=cl>    -a bus_address  <span class=c1># 总线地址</span>
</span></span><span class=line><span class=cl>    -b rate         <span class=c1># 波特率</span>
</span></span><span class=line><span class=cl>    -m mode         <span class=c1># 串口模式</span>
</span></span><span class=line><span class=cl>    -r filename     <span class=c1># 读取flash到文件（或者使用 - 符号， 表示标准输出）</span>
</span></span><span class=line><span class=cl>    -w filename     <span class=c1># 写入文件到flash（或者使用 - 符号， 表示标准输出）</span>
</span></span><span class=line><span class=cl>    -C              <span class=c1># 计算flash crc校验码</span>
</span></span><span class=line><span class=cl>    -u              <span class=c1># 禁用flash写保护</span>
</span></span><span class=line><span class=cl>    -j              <span class=c1># 启用flash读保护</span>
</span></span><span class=line><span class=cl>    -k              <span class=c1># 禁用flash读保护</span>
</span></span><span class=line><span class=cl>    -o              <span class=c1># 仅擦除</span>
</span></span><span class=line><span class=cl>    -e n            <span class=c1># 写入flash前仅擦除n页，默认全擦</span>
</span></span><span class=line><span class=cl>    -v              <span class=c1># 写入后校验</span>
</span></span><span class=line><span class=cl>    -n count        <span class=c1># 写入失败重试次数，默认10</span>
</span></span><span class=line><span class=cl>    -g address      <span class=c1># 指定程序开始执行的地址</span>
</span></span><span class=line><span class=cl>    -S address<span class=o>[</span>:length<span class=o>]</span>       <span class=c1># 指定读取/写入的起始地址和长度（可选）</span>
</span></span><span class=line><span class=cl>    -F RX_length<span class=o>[</span>:TX_length<span class=o>]</span>  <span class=c1># 指定接收/发送帧的最大长度</span>
</span></span><span class=line><span class=cl>    -s start_page   <span class=c1># 在指定的页面写入</span>
</span></span><span class=line><span class=cl>    -f              <span class=c1># 强制二进制解析</span>
</span></span><span class=line><span class=cl>    -h              <span class=c1># 显示帮助信息</span>
</span></span><span class=line><span class=cl>    -c              <span class=c1># 恢复连接</span>
</span></span><span class=line><span class=cl>    -R              <span class=c1># 退出时复位设备</span>
</span></span><span class=line><span class=cl>    -i GPIO_string  <span class=c1># 设置进入/退出BootLoader时信号输出的顺序</span>
</span></span><span class=line><span class=cl>                    <span class=c1># GPIO_string=[entry_seq][:[exit_seq]]</span>
</span></span><span class=line><span class=cl>                    <span class=c1># sequence=[[-]signal]&amp;|,[sequence]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>GPIO sequence:
</span></span><span class=line><span class=cl>    <span class=c1># 使用‘dtr’，‘rts’，‘brk’表示串口输出信号</span>
</span></span><span class=line><span class=cl>    <span class=c1># ‘,’表示在在两个信号之间加100ms延时</span>
</span></span><span class=line><span class=cl>    <span class=c1># ‘&amp;’表示两个信号之间不加延时</span>
</span></span><span class=line><span class=cl>    <span class=c1># 在信号前加‘-’表示低电平，不加表示高电平    </span>
</span></span></code></pre></div><p>读取芯片信息，执行以下命令（root）：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>stm32flash_linux -b 115200 -i &#39;-dtr&amp;rts,dtr:-dtr&amp;-rts,dtr&#39; /dev/ttyUSB0
</span></span></code></pre></div><p>参数说明：</p><ul><li>-b 115200 ，指定115200波特率</li><li>-dtr&rts,dtr<ul><li>-dtr& 拉低复位</li><li>rts, 拉高 BOOT0，延时100ms</li><li>dtr 释放复位，进入 BootLoader</li></ul></li><li>-dtr&-rts,dtr<ul><li>-dtr& 拉低复位</li><li>-rts, 拉低 BOOT0，延时100ms</li><li>dtr 释放复位，flash启动进入用户程序</li></ul></li><li>/dev/ttyUSB0，设备串口</li></ul><p>上述命令执行成功输出以下信息：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Interface serial_posix: 115200 8E1
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GPIO sequence start
</span></span><span class=line><span class=cl> setting port signal dtr to 0... ok
</span></span><span class=line><span class=cl> setting port signal rts to 1... ok
</span></span><span class=line><span class=cl> delay 100000 us
</span></span><span class=line><span class=cl> setting port signal dtr to 1... ok
</span></span><span class=line><span class=cl>GPIO sequence end
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Version      : 0x22
</span></span><span class=line><span class=cl>Option 1     : 0x00
</span></span><span class=line><span class=cl>Option 2     : 0x00
</span></span><span class=line><span class=cl>Devive ID    : 0x0414 (STM32F10XX High-density)
</span></span><span class=line><span class=cl>- RAM        : Up to 64KiB (512b reserved by bootloader)
</span></span><span class=line><span class=cl>- Flash      : Up to 512Kib (size first sector: 2x2048)
</span></span><span class=line><span class=cl>- Option RAM : 16b
</span></span><span class=line><span class=cl>- System RAm : 2KiB
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>GPIO sequence start
</span></span><span class=line><span class=cl> setting port signal dtr to 0... ok
</span></span><span class=line><span class=cl> setting port signal rts to 0... ok
</span></span><span class=line><span class=cl> delay 100000 us
</span></span><span class=line><span class=cl> setting port signal dtr to 1... ok
</span></span><span class=line><span class=cl>GPIO sequence end
</span></span></code></pre></div><p>下载程序，执行以下命令</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>stm32flash_linux -b 115200 -i &#39;-dtr&amp;rts,dtr:-dtr&amp;-rts,dtr&#39; -v -w test.bin /dev/ttyUSB0
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://kingtuo123.com/tags/stm32/>stm32</a></li><li><a href=https://kingtuo123.com/tags/linux/>linux</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://kingtuo123.com/>king's blog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(t=>{const n=t.parentNode.parentNode,e=document.createElement("button");e.classList.add("copy-code"),e.innerHTML="copy";function s(){e.innerHTML="copied!",setTimeout(()=>{e.innerHTML="copy"},2e3)}e.addEventListener("click",o=>{if("clipboard"in navigator){navigator.clipboard.writeText(t.textContent),s();return}const e=document.createRange();e.selectNodeContents(t);const n=window.getSelection();n.removeAllRanges(),n.addRange(e);try{document.execCommand("copy"),s()}catch(e){}n.removeRange(e)}),n.classList.contains("highlight")?n.appendChild(e):n.parentNode.firstChild==n||(t.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?t.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(e):t.parentNode.appendChild(e))})</script></body></html>