<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Docker Samba | King's Blog</title>
<meta name=keywords content="samba"><meta name=description content="在 docker 中运行 samba"><meta name=author content><link rel=canonical href=https://kingtuo123.com/posts/docker-samba/><link crossorigin=anonymous href=/assets/css/stylesheet.3fb4ecf6a2a81497f9b20e665e86d11433da1313db1d8c2d46c26dd61e1a1d3a.css integrity="sha256-P7Ts9qKoFJf5sg5mXobRFDPaExPbHYwtRsJt1h4aHTo=" rel="preload stylesheet" as=style><link rel=icon href=https://kingtuo123.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://kingtuo123.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://kingtuo123.com/favicon-32x32.png><link rel=apple-touch-icon href=https://kingtuo123.com/apple-touch-icon.png><link rel=mask-icon href=https://kingtuo123.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://kingtuo123.com/posts/docker-samba/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:title" content="Docker Samba"><meta property="og:description" content="在 docker 中运行 samba"><meta property="og:type" content="article"><meta property="og:url" content="https://kingtuo123.com/posts/docker-samba/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-04-18T00:00:00+00:00"><meta property="article:modified_time" content="2023-04-18T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docker Samba"><meta name=twitter:description content="在 docker 中运行 samba"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://kingtuo123.com/posts/"},{"@type":"ListItem","position":2,"name":"Docker Samba","item":"https://kingtuo123.com/posts/docker-samba/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Docker Samba","name":"Docker Samba","description":"在 docker 中运行 samba","keywords":["samba"],"articleBody":"准备 创建 dockerfile 和 start.sh\ndockerfile FROM ubuntu:latest LABEL author=\"king\" EXPOSE 445 139 COPY start.sh /root/ RUN set -ex \u0026\u0026 \\ sed -i s@/archive.ubuntu.com/@/mirrors.tuna.tsinghua.edu.cn/@g /etc/apt/sources.list \u0026\u0026 \\ apt clean \u0026\u0026 \\ apt update \u0026\u0026 \\ apt -y install samba \u0026\u0026 \\ chmod u+x /root/start.sh CMD /root/start.sh start.sh #!/bin/bash useradd -r -s /usr/sbin/nologin -u $UID $UNAME echo -e \"$UPASSWD\\n$UPASSWD\" | smbpasswd -a $UNAME /etc/init.d/smbd start /bin/bash 末尾 /bin/bash 防止容器直接退出\n构建镜像 $ docker build -t mysamba:latest . 配置 Samba 本地创建 smb.conf 配置文件，参考 Samba 安装及配置\n[global] workgroup = Home netbios name = king's laptop server string = king's SambaServer display charset = UTF8 #interfaces = wlp2s0 #hosts allow = 192.168.1. deadtime = 10 log file = /var/log/samba/log.%m max log size = 50 map to guest = Bad User max connections = 0 # 可guest登录，可读，指定用户可写 [Shared] path = /home/king/Shared security = share public = yes writable = yes write list = king available = yes browseable = yes # 需要用户登录，可读写 [Private] path = /home/king public = no valid users = king create mask = 0664 directory mask = 0775 available = yes browseable = yes writable = yes write list = king 运行容器 $ docker run -it --rm -d \\ --name samba \\ -e UID=1000 \\ -e UNAME=king \\ -e UPASSWD=123456 \\ -p 445:445 \\ -p 139:139 \\ -v /home/king/Docker/samba/:/etc/samba:ro \\ -v /home/king:/home/king:rw \\ -v /home/king/Shared:/home/king/Shared:rw \\ mysamba /home/king/Docker/samba 为 smb.conf 文件所在目录\n/home/king 和 /home/king/Public 这两个目录是在 smb.conf 中配置的共享目录。\n","wordCount":"234","inLanguage":"en","datePublished":"2023-04-18T00:00:00Z","dateModified":"2023-04-18T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://kingtuo123.com/posts/docker-samba/"},"publisher":{"@type":"Organization","name":"King's Blog","logo":{"@type":"ImageObject","url":"https://kingtuo123.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://kingtuo123.com/ accesskey=h title="Notes (Alt + H)">Notes</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li></ul></div></div><ul id=menu><li><a href=https://kingtuo123.com/archives title=Archive>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox=".5 1 15 15" fill="none" stroke="currentcolor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round"><rect height="3.5" width="12.5" y="2.75" x="1.75"/><path d="m6.75 9.25h2.5m-6.5-2.5v7.5h10.5v-7.5"/></svg></span></a></li><li><a href=https://kingtuo123.com/categories/ title=Categories>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox=".5 .5 23 23" fill="none" stroke="currentcolor" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg></span></a></li><li><a href=https://kingtuo123.com/tags/ title=Tags>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="1 0 15 15" fill="none" stroke="currentcolor" stroke-width="1.1" stroke-linecap="round" stroke-linejoin="round" transform="matrix(-1,0,0,1,0,0)"><polygon points="7.25 14.25,1.75 8.75,8.75 1.75,14.25 1.75,14.25 7.25"/><circle cx="11" cy="5" r=".5" fill="#000"/></svg></span></a></li><li><a href=https://kingtuo123.com/search/ title="Search (Alt + /)" accesskey=/>&nbsp;
<span class=menu-logo><svg class="logo-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="1.9" stroke-linecap="round" stroke-linejoin="round"><path d="M21 21l-4.4857-4.4935M19 10.5c0 4.6944-3.8056 8.5-8.5 8.5C5.80558 19 2 15.1944 2 10.5 2 5.80558 5.80558 2 10.5 2 15.1944 2 19 5.80558 19 10.5z"/></svg></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Docker Samba</h1><div class=post-meta><span title='2023-04-18 00:00:00 +0000 UTC'>April 18, 2023</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#%e5%87%86%e5%a4%87 aria-label=准备>准备</a><ul><li><a href=#dockerfile aria-label=dockerfile>dockerfile</a></li><li><a href=#startsh aria-label=start.sh>start.sh</a></li></ul></li><li><a href=#%e6%9e%84%e5%bb%ba%e9%95%9c%e5%83%8f aria-label=构建镜像>构建镜像</a></li><li><a href=#%e9%85%8d%e7%bd%ae-samba aria-label="配置 Samba">配置 Samba</a></li><li><a href=#%e8%bf%90%e8%a1%8c%e5%ae%b9%e5%99%a8 aria-label=运行容器>运行容器</a></li></ul></div></details></div><div class=post-content><h2 id=准备>准备<a hidden class=anchor aria-hidden=true href=#准备>#</a></h2><p>创建 <code>dockerfile</code> 和 <code>start.sh</code></p><h3 id=dockerfile>dockerfile<a hidden class=anchor aria-hidden=true href=#dockerfile>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-dockerfile data-lang=dockerfile><span class=line><span class=cl><span class=k>FROM</span><span class=s> ubuntu:latest</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>LABEL</span> <span class=nv>author</span><span class=o>=</span><span class=s2>&#34;king&#34;</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>EXPOSE</span><span class=s> 445 139</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>COPY</span> start.sh /root/<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>RUN</span> <span class=nb>set</span> -ex <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        sed -i s@/archive.ubuntu.com/@/mirrors.tuna.tsinghua.edu.cn/@g /etc/apt/sources.list <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        apt clean <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        apt update <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        apt -y install samba <span class=o>&amp;&amp;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span>        chmod u+x /root/start.sh<span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=k>CMD</span> /root/start.sh<span class=err>
</span></span></span></code></pre></div><h3 id=startsh>start.sh<a hidden class=anchor aria-hidden=true href=#startsh>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=cp>#!/bin/bash
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>useradd -r -s /usr/sbin/nologin -u <span class=nv>$UID</span> <span class=nv>$UNAME</span>
</span></span><span class=line><span class=cl><span class=nb>echo</span> -e <span class=s2>&#34;</span><span class=nv>$UPASSWD</span><span class=s2>\n</span><span class=nv>$UPASSWD</span><span class=s2>&#34;</span> <span class=p>|</span> smbpasswd -a <span class=nv>$UNAME</span>
</span></span><span class=line><span class=cl>/etc/init.d/smbd start
</span></span><span class=line><span class=cl>/bin/bash
</span></span></code></pre></div><blockquote><p>末尾 <code>/bin/bash</code> 防止容器直接退出</p></blockquote><h2 id=构建镜像>构建镜像<a hidden class=anchor aria-hidden=true href=#构建镜像>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash-session data-lang=bash-session><span class=line><span class=cl><span class=gp>$</span> docker build -t mysamba:latest .
</span></span></code></pre></div><h2 id=配置-samba>配置 Samba<a hidden class=anchor aria-hidden=true href=#配置-samba>#</a></h2><p>本地创建 <code>smb.conf</code> 配置文件，参考 <a href=../samba-config/>Samba 安装及配置</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>[global]
</span></span><span class=line><span class=cl>workgroup = Home
</span></span><span class=line><span class=cl>netbios name = king&#39;s laptop
</span></span><span class=line><span class=cl>server string = king&#39;s SambaServer
</span></span><span class=line><span class=cl>display charset = UTF8
</span></span><span class=line><span class=cl>#interfaces = wlp2s0
</span></span><span class=line><span class=cl>#hosts allow = 192.168.1.
</span></span><span class=line><span class=cl>deadtime = 10
</span></span><span class=line><span class=cl>log file = /var/log/samba/log.%m
</span></span><span class=line><span class=cl>max log size = 50
</span></span><span class=line><span class=cl>map to guest = Bad User
</span></span><span class=line><span class=cl>max connections = 0
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 可guest登录，可读，指定用户可写
</span></span><span class=line><span class=cl>[Shared]
</span></span><span class=line><span class=cl>path = /home/king/Shared
</span></span><span class=line><span class=cl>security = share
</span></span><span class=line><span class=cl>public = yes
</span></span><span class=line><span class=cl>writable = yes
</span></span><span class=line><span class=cl>write list = king
</span></span><span class=line><span class=cl>available = yes
</span></span><span class=line><span class=cl>browseable = yes
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 需要用户登录，可读写
</span></span><span class=line><span class=cl>[Private]
</span></span><span class=line><span class=cl>path = /home/king
</span></span><span class=line><span class=cl>public = no
</span></span><span class=line><span class=cl>valid users = king
</span></span><span class=line><span class=cl>create mask = 0664
</span></span><span class=line><span class=cl>directory mask = 0775
</span></span><span class=line><span class=cl>available = yes
</span></span><span class=line><span class=cl>browseable = yes
</span></span><span class=line><span class=cl>writable = yes
</span></span><span class=line><span class=cl>write list = king
</span></span></code></pre></div><h2 id=运行容器>运行容器<a hidden class=anchor aria-hidden=true href=#运行容器>#</a></h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>$ docker run -it --rm -d \
</span></span><span class=line><span class=cl>    --name samba \
</span></span><span class=line><span class=cl>    -e UID=1000 \
</span></span><span class=line><span class=cl>    -e UNAME=king \
</span></span><span class=line><span class=cl>    -e UPASSWD=123456 \
</span></span><span class=line><span class=cl>    -p 445:445 \
</span></span><span class=line><span class=cl>    -p 139:139 \
</span></span><span class=line><span class=cl>    -v /home/king/Docker/samba/:/etc/samba:ro \
</span></span><span class=line><span class=cl>    -v /home/king:/home/king:rw \
</span></span><span class=line><span class=cl>    -v /home/king/Shared:/home/king/Shared:rw \
</span></span><span class=line><span class=cl>    mysamba
</span></span></code></pre></div><p><code>/home/king/Docker/samba</code> 为 <code>smb.conf</code> 文件所在目录</p><p><code>/home/king</code> 和 <code>/home/king/Public</code> 这两个目录是在 <code>smb.conf</code> 中配置的共享目录。</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://kingtuo123.com/tags/samba/>Samba</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://kingtuo123.com/>King's Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><div class=extend_footer align=center style="padding:5px 0 0"><a rel=nofollow href=mailto:kingtuo123@foxmail.com target=_blank>kingtuo123@foxmail.com</a></div><div class=extend_footer align=center style="padding:5px 0 0"><a href=https://beian.miit.gov.cn/ target=_blank>浙ICP备19041170号</a></div><div class=extend_footer align=center style="padding:5px 0 10px"><a href="https://beian.mps.gov.cn/#/query/webSearch?code=33032402001943" rel=noreferrer target=_blank>浙公网安备33032402001943</a></div><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>